/* 
 * conekta.js v1.0.0
 * Conekta 2013
 * https://github.com/conekta/conekta.js/blob/master/LICENSE.txt
 */
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;if(e="https://api.conekta.io/",w="",c="es",l="205000",d={},window.conektaAjax||("undefined"!=typeof jQuery?window.conektaAjax=jQuery.ajax:console.error("no either a jQuery or ajax function provided")),m=function(a){var b;if("undefined"==typeof localStorage||"undefined"==typeof localStorage.getItem)return null;try{return localStorage.setItem("testKey","1"),localStorage.removeItem("testKey"),localStorage.getItem(a)}catch(c){return b=c,null}},n=function(a,b){var c;if("undefined"==typeof localStorage||"undefined"==typeof localStorage.setItem)return null;try{return localStorage.setItem("testKey","1"),localStorage.removeItem("testKey"),localStorage.setItem(a,b)}catch(d){return c=d,null}},r=m("_conekta_publishable_key"),f=function(){var a,b,c,d;if("undefined"==typeof document||"undefined"==typeof document.body||!document.body||"interactive"!==document.readyState&&"complete"!==document.readyState||"undefined"==typeof Conekta)setTimeout(f,150);else if(!Conekta._helpers.finger_printed){Conekta._helpers.finger_printed=!0,a=document.getElementsByTagName("body")[0],c=document.createElement("iframe"),c.setAttribute("height","1"),c.setAttribute("scrolling","no"),c.setAttribute("frameborder","0"),c.setAttribute("width","1"),c.setAttribute("src",e+"fraud_providers/kount/logo.htm?m="+l+"&s="+w),d=document.createElement("img"),d.setAttribute("height","1"),d.setAttribute("width","1"),d.setAttribute("src",e+"fraud_providers/kount/logo.gif?m="+l+"&s="+w);try{c.appendChild(d)}catch(g){b=g}a.appendChild(c)}},v=function(){var a,b;"undefined"==typeof document||"undefined"==typeof document.body||!document.body||"interactive"!==document.readyState&&"complete"!==document.readyState||"undefined"==typeof Conekta?setTimeout(v,150):Conekta._helpers.beacon_sent||(d.riskified&&(b=function(){var a,b,c,e;b=d.riskified.domain,w=w,c=("https:"===document.location.protocol?"https://":"http://")+"beacon.riskified.com?shop="+b+"&sid="+w,a=document.createElement("script"),a.type="text/javascript",a.async=!0,a.src=c,e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(a,e)})(),d.siftscience&&(a=w,window._sift=window._sift||[],_sift.push(["_setAccount",d.siftscience.beacon_key]),_sift.push(["_setSessionId",w]),_sift.push(["_trackPageview"]),(b=function(){var a,b;a=document.createElement("script"),a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.siftscience.com/s.js",b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()))},m("_conekta_session_id")&&m("_conekta_session_id_timestamp")&&(new Date).getTime()-6e5<parseInt(m("_conekta_session_id_timestamp")))w=localStorage.getItem("_conekta_session_id"),f();else if("undefined"!=typeof Shopify)"undefined"==typeof Shopify.getCart&&"undefined"!=typeof jQuery&&(Shopify.getCart=function(a){return jQuery.getJSON("/cart.js",function(b){return"function"==typeof a?a(b):void 0})}),h=function(a){w=a.token,null!==w&&""!==w&&(f(),v(),n("_conekta_session_id",w),n("_conekta_session_id_timestamp",(new Date).getTime().toString()))},"undefined"!=typeof Shopify.getCart&&Shopify.getCart(function(a){h(a)}),o=Shopify.getCart,Shopify.getCart=function(a){var b;b=function(b){h(b),a(b)},o(b)},q=Shopify.onItemAdded,Shopify.onItemAdded=function(a){var b;b=function(b){Shopify.getCart(function(a){h(a)}),a(b)},q(b)},p=Shopify.onCartUpdated,Shopify.onCartUpdated=function(a){var b;b=function(b){h(b),a(b)},p(b)},"undefined"!=typeof jQuery&&jQuery(document).ajaxSuccess(function(a,b,c,d){"cart/add.js"===c.url&&Shopify.getCart(function(a){h(a)})});else{if(x="abcdefghijklmnopqrstuvwxyz0123456789","undefined"!=typeof crypto&&"undefined"!=typeof crypto.getRandomValues)for(t=new Uint32Array(32),crypto.getRandomValues(t),i=j=0,u=t.length-1;u>=0?u>=j:j>=u;i=u>=0?++j:--j)w+=x.charAt(t[i]%36);else for(i=k=0;30>=k;i=++k)s=Math.floor(36*Math.random()),w+=x.charAt(s);n("_conekta_session_id",w),n("_conekta_session_id_timestamp",(new Date).getTime().toString()),f()}g=function(){var a,b,c,e;return c=m("conekta_antifraud_config"),c&&c.match(/^\{/)?d=JSON.parse(c):(b=function(a){return d=a,n("conekta_antifraud_config",d),v()},a=function(){},e="https://d3fxnri0mz3rya.cloudfront.net/antifraud/"+r+".js",conektaAjax({url:e,dataType:"jsonp",jsonpCallback:"conekta_antifraud_config_jsonp",success:b,error:a}))},g(),b={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var c,d,e,f,g,h,j,k;for(k="",c=void 0,d=void 0,e=void 0,f=void 0,g=void 0,h=void 0,j=void 0,i=0,a=b._utf8_encode(a);i<a.length;)c=a.charCodeAt(i++),d=a.charCodeAt(i++),e=a.charCodeAt(i++),f=c>>2,g=(3&c)<<4|d>>4,h=(15&d)<<2|e>>6,j=63&e,isNaN(d)?h=j=64:isNaN(e)&&(j=64),k=k+b._keyStr.charAt(f)+b._keyStr.charAt(g)+b._keyStr.charAt(h)+b._keyStr.charAt(j);return k},decode:function(a){var c,d,e,f,g,h,j,k;for(k="",c=void 0,d=void 0,e=void 0,f=void 0,g=void 0,h=void 0,j=void 0,i=0,a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");i<a.length;)f=b._keyStr.indexOf(a.charAt(i++)),g=b._keyStr.indexOf(a.charAt(i++)),h=b._keyStr.indexOf(a.charAt(i++)),j=b._keyStr.indexOf(a.charAt(i++)),c=f<<2|g>>4,d=(15&g)<<4|h>>2,e=(3&h)<<6|j,k+=String.fromCharCode(c),64!==h&&(k+=String.fromCharCode(d)),64!==j&&(k+=String.fromCharCode(e));return k=b._utf8_decode(k)},_utf8_encode:function(a){var b,c,d;for(a=a.replace(/\r\n/g,"\n"),d="",c=0;c<a.length;)b=a.charCodeAt(c),128>b?d+=String.fromCharCode(b):b>127&&2048>b?(d+=String.fromCharCode(b>>6|192),d+=String.fromCharCode(63&b|128)):(d+=String.fromCharCode(b>>12|224),d+=String.fromCharCode(b>>6&63|128),d+=String.fromCharCode(63&b|128)),c++;return d},_utf8_decode:function(a){var b,c,d,e,f;for(f="",i=0,b=c=d=0;i<a.length;)b=a.charCodeAt(i),128>b?(f+=String.fromCharCode(b),i++):b>191&&224>b?(d=a.charCodeAt(i+1),f+=String.fromCharCode((31&b)<<6|63&d),i+=2):(d=a.charCodeAt(i+1),e=a.charCodeAt(i+2),f+=String.fromCharCode((15&b)<<12|(63&d)<<6|63&e),i+=3);return f}},window.Conekta||(window.Conekta={setLanguage:function(a){return c=a},getLanguage:function(){return c},setPublicKey:function(a){"string"==typeof a&&a.match(/^[a-zA-Z0-9_]*$/)&&a.length>=20&&a.length<30?(r=a,n("_conekta_publishable_key",r)):Conekta._helpers.log("Unusable public key: "+a)},getPublicKey:function(a){return r},_helpers:{finger_printed:!1,beacon_sent:!1,objectKeys:function(a){var b,c;b=[];for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b},parseForm:function(a){var b,c,d,e,f,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;if(h={},"object"==typeof a){if("undefined"!=typeof jQuery&&(a instanceof jQuery||"jquery"in Object(a))&&(a=a.get()[0],"object"!=typeof a))return{};if(a.nodeType){for(x=a.getElementsByTagName("textarea"),g=a.getElementsByTagName("input"),w=a.getElementsByTagName("select"),b=new Array(x.length+g.length+w.length),i=j=0,t=x.length-1;t>=j;i=j+=1)b[i]=x[i];for(i=n=0,u=g.length-1;u>=n;i=n+=1)b[i+x.length]=g[i];for(i=p=0,v=w.length-1;v>=p;i=p+=1)b[i+x.length+g.length]=w[i];for(r=0,l=b.length;l>r;r++)if(f=b[r],f&&(d=f.getAttribute("data-conekta"))){for(y="SELECT"===f.tagName?f.value:f.getAttribute("value")||f.innerHTML||f.value,e=d.replace(/\]/g,"").replace(/\-/g,"_").split(/\[/),q=null,o=h,k=null,s=0,m=e.length;m>s;s++)c=e[s],o[c]||(o[c]={}),q=o,k=c,o=o[c];q[k]=y}}else h=a}return h},getSessionId:function(){return w},xDomainPost:function(a){var c,d,f;return f=function(b,c,d){return b&&"error"!==b.object&&b.id?a.success(b):a.error(b||{object:"error",type:"api_error",message:"Something went wrong on Conekta's end",message_to_purchaser:"Your code could not be processed, please try again later"})},c=function(){return a.error({object:"error",type:"api_error",message:"Something went wrong, possibly a connectivity issue",message_to_purchaser:"Your code could not be processed, please try again later"})},"file:"===document.location.protocol&&-1!==navigator.userAgent.indexOf("MSIE")?(a.url=(a.jsonp_url||a.url)+"/create.js",a.data._Version="0.3.0",a.data._RaiseHtmlError=!1,a.data.auth_token=Conekta.getPublicKey(),a.data.conekta_client_user_agent='{"agent":"Conekta JavascriptBindings/0.3.0"}',conektaAjax({url:e+a.url,dataType:"jsonp",data:a.data,success:f,error:c})):"undefined"!=typeof(new XMLHttpRequest).withCredentials?conektaAjax({url:e+a.url,type:"POST",dataType:"json",data:JSON.stringify(a.data),contentType:"application/json",headers:{RaiseHtmlError:!1,Accept:"application/vnd.conekta-v0.3.0+json","Accept-Language":Conekta.getLanguage(),"Conekta-Client-User-Agent":'{"agent":"Conekta JavascriptBindings/0.3.0"}',Authorization:"Basic "+b.encode(Conekta.getPublicKey()+":")},success:f,error:c}):(d=new easyXDM.Rpc({swf:"https://conektaapi.s3.amazonaws.com/v0.3.2/flash/easyxdm.swf",remote:e+"easyxdm_cors_proxy.html"},{remote:{request:{}}}),d.request({url:e+a.url,method:"POST",headers:{RaiseHtmlError:!1,Accept:"application/vnd.conekta-v0.3.0+json","Accept-Language":Conekta.getLanguage(),"Conekta-Client-User-Agent":'{"agent":"Conekta JavascriptBindings/0.3.0"}',Authorization:"Basic "+b.encode(Conekta.getPublicKey()+":")},data:JSON.stringify(a.data)},f,c))},log:function(a){return"undefined"!=typeof console&&console.log?console.log(a):void 0},querySelectorAll:function(a){var b,c,d;if(document.querySelectorAll)return document.querySelectorAll(a);for(d=document.createElement("style"),c=[],document.documentElement.firstChild.appendChild(d),document._qsa=[],d.styleSheet?d.styleSheet.cssText=a+"{x-qsa:expression(document._qsa && document._qsa.push(this))}":d.style.cssText=a+"{x-qsa:expression(document._qsa && document._qsa.push(this))}",window.scrollBy(0,0),d.parentNode.removeChild(d);document._qsa.length;)b=document._qsa.shift(),b.style.removeAttribute("x-qsa"),c.push(b);return document._qsa=null,c},querySelector:function(a){var b;return document.querySelector?document.querySelector(a):(b=this.querySelectorAll(a),b.length>0?b[0]:null)}}},Conekta._helpers.querySelectorAll("script[data-conekta-session-id]").length>0&&(a=Conekta._helpers.querySelectorAll("script[data-conekta-session-id]")[0],w=a.getAttribute("data-conekta-session-id")),Conekta._helpers.querySelectorAll("script[data-conekta-public-key]").length>0&&(a=Conekta._helpers.querySelectorAll("script[data-conekta-public-key]")[0],window.Conekta.setPublicKey(a.getAttribute("data-conekta-public-key"))))}).call(this),function(){var a,b,c,d,e,f,g,h=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};b=[{name:"amex",pattern:/^3[47]/,valid_length:[15]},{name:"diners_club_carte_blanche",pattern:/^30[0-5]/,valid_length:[14]},{name:"diners_club_international",pattern:/^36/,valid_length:[14]},{name:"jcb",pattern:/^35(2[89]|[3-8][0-9])/,valid_length:[16]},{name:"laser",pattern:/^(6304|670[69]|6771)/,valid_length:[16,17,18,19]},{name:"visa_electron",pattern:/^(4026|417500|4508|4844|491(3|7))/,valid_length:[16]},{name:"visa",pattern:/^4/,valid_length:[16]},{name:"mastercard",pattern:/^5[1-5]/,valid_length:[16]},{name:"maestro",pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,valid_length:[12,13,14,15,16,17,18,19]},{name:"discover",pattern:/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/,valid_length:[16]}],e=function(a){var b,c,d,e,f,g;for(g=0,f=a.split("").reverse(),e=c=0,d=f.length;d>c;e=++c)b=f[e],b=+b,e%2?(b*=2,g+=10>b?b:b-9):g+=b;return g%10===0},d=function(a,b){var c;return c=a.length,h.call(b.valid_length,c)>=0},a=["visa","mastercard","maestro","visa_electron","amex","laser","diners_club_carte_blanche","diners_club_international","discover","jcb"],c=function(c){var d,e,f,g,i;for(i=function(){var c,e,f,g;for(g=[],c=0,e=b.length;e>c;c++)d=b[c],f=d.name,h.call(a,f)>=0&&g.push(d);return g}(),f=0,g=i.length;g>f;f++)if(e=i[f],c.match(e.pattern))return e;return null},f=function(a){return"string"==typeof a&&a.match(/^[\d]{1,2}$/)?parseInt(a):a},g=function(a){return"number"==typeof a&&100>a&&(a+=2e3),"string"==typeof a&&a.match(/^([\d]{2,2}|20[\d]{2,2})$/)?(a.match(/^([\d]{2,2})$/)&&(a="20"+a),parseInt(a)):a},Conekta.card={},Conekta.card.getBrand=function(a){var b;return"string"==typeof a?a=a.replace(/[ -]/g,""):"number"==typeof a&&(a=toString(a)),b=c(a),b&&b.name?b.name:null},Conekta.card.validateCVC=function(a){return"number"==typeof a&&a>=0&&1e4>a||"string"==typeof a&&null!==a.match(/^[\d]{3,4}$/)},Conekta.card.validateExpMonth=function(a){var b;return b=f(a),"number"==typeof b&&b>0&&13>b},Conekta.card.validateExpYear=function(a){var b;return b=g(a),"number"==typeof b&&b>2013&&2035>b},Conekta.card.validateExpirationDate=function(a,b){var c,d;return c=f(a),d=g(b),"number"==typeof c&&c>0&&13>c&&"number"==typeof d&&d>2013&&2035>d?new Date(d,c,new Date(d,c,0).getDate())>new Date:!1},Conekta.card.validateExpiry=function(a,b){return Conekta.card.validateExpirationDate(a,b)},Conekta.card.validateName=function(a){return"string"==typeof a&&null!==a.match(/^\s*[A-z]+\s+[A-z]+[\sA-z]*$/)&&null===a.match(/visa|master\s*card|amex|american\s*express|banorte|banamex|bancomer|hsbc|scotiabank|jcb|diners\s*club|discover/i)},Conekta.card.validateNumber=function(a){var b,f,g;return a="string"==typeof a?a.replace(/[ -]/g,""):"number"==typeof a?a.toString():"",b=c(a),g=!1,f=!1,null!=b&&(g=e(a),f=d(a,b)),g&&f}}.call(this),function(){Conekta.Token={},Conekta.Token.create=function(a,b,c){var d;return"function"!=typeof b&&(b=Conekta._helpers.log),"function"!=typeof c&&(c=Conekta._helpers.log),d=Conekta._helpers.parseForm(a),"object"==typeof d?Conekta._helpers.objectKeys(d).length>0?(d.card?d.card.device_fingerprint=Conekta._helpers.getSessionId():c({object:"error",type:"invalid_request_error",message:"The form or hash has no attributes 'card'.  If you are using a form, please ensure that you have have an input or text area with the data-conekta attribute 'card[number]'.  For an example form see: https://github.com/conekta/conekta.js/blob/master/examples/credit_card.html",message_to_purchaser:"The card could not be processed, please try again later"}),d.card&&d.card.address&&!(d.card.address.street1||d.card.address.street2||d.card.address.street3||d.card.address.city||d.card.address.state||d.card.address.country||d.card.address.zip)&&delete d.card.address,Conekta._helpers.xDomainPost({jsonp_url:"tokens",url:"tokens",data:d,success:b,error:c})):c({object:"error",type:"invalid_request_error",message:"supplied parameter 'token' is usable object but has no values (e.g. amount, description) associated with it",message_to_purchaser:"The card could not be processed, please try again later"}):c({object:"error",type:"invalid_request_error",message:"Supplied parameter 'token' is not a javascript object or a form",message_to_purchaser:"The card could not be processed, please try again later"})}}.call(this);